var HARUSHOP=HARUSHOP||{};!function(a){"use strict";HARUSHOP={init:function(){HARUSHOP.$html=a("html"),HARUSHOP.$window=a(window),HARUSHOP.$shopFilterMenu=a("#haru-shop-filter-menu"),HARUSHOP.$searchPanel=a("#haru-shop-search"),HARUSHOP.$shopWrap=a(".haru-archive-product"),HARUSHOP.$shopBrowseWrap=a(".archive-product-wrapper"),HARUSHOP.$searchBtn=a("#haru-shop-search-btn"),HARUSHOP.$searchNotice=a("#haru-shop-search-notice"),HARUSHOP.filterPanelSliding=!1,HARUSHOP.filterPanelSlideSpeed=300,HARUSHOP.shopLoaderSpeed=300,HARUSHOP.shopFilterMenuFnNames={cat:"shopFiltersCategoriesToggle",filter:"shopFiltersSidebarToggle",search:"shopFiltersSearchToggle"},HARUSHOP.$window.on("popstate.harushop",function(a){a.originalEvent.state&&a.originalEvent.state.haruShop&&HARUSHOP.shopGetPage(window.location.href,!0)}),HARUSHOP.$html.hasClass("history")?(HARUSHOP.hasPushState=!0,window.history.replaceState({haruShop:!0},"",window.location.href)):HARUSHOP.hasPushState=!1,HARUSHOP.shopFiltersBind(),HARUSHOP.shopSearchBind(),HARUSHOP.shopLoadmoreBind()},shopFiltersBind:function(){HARUSHOP.$shopFilterMenu.find("a").bind("click",function(b){if(b.preventDefault(),!HARUSHOP.filterPanelSliding){HARUSHOP.filterPanelSliding=!0;var c=0,d=a(this).parent("li"),e=d.data("panel");d.hasClass("active")||(c=HARUSHOP.shopFiltersHideActivePanel()),d.toggleClass("active"),setTimeout(function(){var a=HARUSHOP.shopFilterMenuFnNames[e];HARUSHOP[a]()},c)}}),HARUSHOP.$shopWrap.on("click","#haru-shop-categories a",function(b){b.preventDefault();var c=a(this),d=c.parent("li");HARUSHOP.$searchBtn.parent("li").hasClass("active")&&HARUSHOP.$searchBtn.trigger("click"),a("#haru-shop-categories").children(".current-cat").removeClass("current-cat"),d.addClass("current-cat"),HARUSHOP.shopGetPage(c.attr("href"))}),HARUSHOP.$shopWrap.on("click","#haru-shop-sidebar .haru_widget a",function(b){b.preventDefault(),HARUSHOP.shopGetPage(a(this).attr("href"))}),HARUSHOP.$shopWrap.on("click","#haru-shop-sidebar .widget_product_categories a",function(b){b.preventDefault(),HARUSHOP.shopGetPage(a(this).attr("href"))}),HARUSHOP.$shopWrap.on("click","#haru-shop-sidebar .widget_layered_nav a",function(b){b.preventDefault(),HARUSHOP.shopGetPage(a(this).attr("href"))}),HARUSHOP.$shopWrap.on("click","#haru-shop-sidebar .widget_layered_nav_filters a",function(b){b.preventDefault(),HARUSHOP.shopGetPage(a(this).attr("href"))}),HARUSHOP.$shopWrap.on("click","#haru-shop-sidebar .widget_product_tag_cloud a",function(b){b.preventDefault(),HARUSHOP.shopGetPage(a(this).attr("href"),!1,!0)}),HARUSHOP.$shopWrap.on("click","#haru-shop-sidebar .widget_rating_filter a",function(b){b.preventDefault(),HARUSHOP.shopGetPage(a(this).attr("href"))}),HARUSHOP.$shopWrap.on("click","#haru-shop-filters-reset",function(a){a.preventDefault();var b=location.href.replace(location.search,"");HARUSHOP.shopGetPage(b)}),HARUSHOP.$shopWrap.on("click","#haru-shop-search-taxonomy-reset",function(b){b.preventDefault();var c=a(this);if(c.closest(".haru-shop-results-bar").hasClass("is-search")){var d=HARUSHOP.urlGetParameter("s"),e=d?c.data("shop-url"):location.href.replace(location.search,"");HARUSHOP.$searchBtn.trigger("click")}else var e=c.data("shop-url");HARUSHOP.shopGetPage(e)}),HARUSHOP.$shopWrap.on("click","#haru-shop-sidebar .widget-title",function(b){a(this).toggleClass("active"),a(this).parent().find("div, ul").toggleClass("show")})},shopFiltersHideActivePanel:function(){var a=0,b=HARUSHOP.$shopFilterMenu.children(".active");if(b.length){b.removeClass("active");var c=b.data("panel");if(b.is(":hidden")&&"cat"==c)HARUSHOP.shopFiltersCategoriesReset();else{a=300;var d=HARUSHOP.shopFilterMenuFnNames[c];HARUSHOP[d]()}}return a},shopFiltersCategoriesToggle:function(){a("#haru-shop-categories").slideToggle(HARUSHOP.filterPanelSlideSpeed,function(){var b=a(this);b.toggleClass("fade-in"),b.hasClass("fade-in")||b.removeClass("force-show").css("display",""),HARUSHOP.filterPanelSliding=!1})},shopFiltersCategoriesReset:function(){a("#haru-shop-categories").removeClass("fade-in force-show").css("display","")},shopFiltersSidebarToggle:function(){var b=a("#haru-shop-sidebar"),c=b.is(":visible");c&&b.removeClass("fade-in"),b.slideToggle(HARUSHOP.filterPanelSlideSpeed,function(){c||b.addClass("fade-in"),HARUSHOP.filterPanelSliding=!1})},shopFiltersSearchToggle:function(){HARUSHOP.searchPanelToggle(),HARUSHOP.currentSearch=""},searchPanelToggle:function(){var b=a("#haru-shop-search-input");HARUSHOP.$searchPanel.slideToggle(200,function(){HARUSHOP.$searchPanel.toggleClass("fade-in"),HARUSHOP.$searchPanel.hasClass("fade-in")?b.focus():b.val(""),HARUSHOP.filterPanelSliding=!1}),HARUSHOP.shopSearchHideNotice()},shopSearchHideNotice:function(b){a("#haru-shop-search-notice").removeClass("show")},shopGetPage:function(b,c,d){if(HARUSHOP.shopAjax)return!1;b&&(HARUSHOP.shopShowLoader(),b=b.replace(/\/?(\?|#|$)/,"/$1"),c||HARUSHOP.setPushState(b),HARUSHOP.shopAjax=a.ajax({url:b,data:{shop_load:"full"},dataType:"html",cache:!1,headers:{"cache-control":"no-cache"},method:"POST",error:function(a,b,c){console.log("Haru: AJAX error - shopGetPage() - "+c),HARUSHOP.shopHideLoader(),HARUSHOP.shopAjax=!1},success:function(a){HARUSHOP.shopUpdateContent(a),HARUSHOP.shopLoadmoreBind(),HARUSHOP.shopAjax=!1}}))},setPushState:function(a){window.history.pushState({haruShop:!0},"",a)},shopUpdateContent:function(b){var c=a("<div>"+b+"</div>"),d=c.find("#haru-shop-categories"),e=c.find("#haru-shop-widgets-ul"),f=c.find(".archive-product-wrapper");if(d.length){var g=a("#haru-shop-categories");g.hasClass("fade-in")&&d.addClass("fade-in force-show"),g.replaceWith(d)}if(e.length){a("#haru-shop-widgets-ul").replaceWith(e)}f.length&&HARUSHOP.$shopBrowseWrap.replaceWith(f),HARUSHOP.$shopBrowseWrap=a(".archive-product-wrapper"),HARUSHOP.$shopBrowseWrap.find("ul.products").addClass("grid"),HARU.woocommerce.init()},shopShowLoader:function(b){a("#haru-shop-products-overlay").addClass("show")},shopHideLoader:function(b){var c=a("#haru-shop-products-overlay");c.removeClass("haru-loader").addClass("fade-out"),setTimeout(function(){c.removeClass("show fade-out").addClass("haru-loader")},HARUSHOP.shopLoaderSpeed)},shopSearchBind:function(){var b,c,d,e;HARUSHOP.$searchInput=a("#haru-shop-search-input"),HARUSHOP.searchAjax=null,HARUSHOP.currentSearch="",a("#haru-shop-search-close").bind("click",function(a){a.preventDefault(),HARUSHOP.$searchBtn.trigger("click")}),a("#haru-shop-search-input").on("input",function(){var a=HARUSHOP.$searchInput.val();a=a.trim(),e=a.length,e?HARUSHOP.$searchNotice.addClass("show"):HARUSHOP.$searchNotice.removeClass("show")}).trigger("input"),HARUSHOP.$searchInput.keypress(function(e){if(b=a(this),c=b.val(),"13"==(d=e.keyCode?e.keyCode:e.which)){e.preventDefault();var f=HARUSHOP.$searchInput.val();f=f.trim(),f.length&&HARUSHOP.currentSearch!==c?setTimeout(function(){HARUSHOP.shopSearch(c)},HARUSHOP.filterPanelSlideSpeed):HARUSHOP.currentSearch=c}})},shopSearch:function(b){HARUSHOP.shopShowLoader(),HARUSHOP.currentSearch=b,HARUSHOP.searchAjax=a.ajax({url:searchUrl+encodeURIComponent(b),data:{shop_load:"search",post_type:"product"},dataType:"html",method:"GET",error:function(a,b,c){console.log("Haru: AJAX error - shopSearch() - "+c),HARUSHOP.shopHideLoader(),HARUSHOP.searchAjax=null},success:function(a){HARUSHOP.shopUpdateContent(a),HARUSHOP.shopLoadmoreBind(),HARUSHOP.searchAjax=null}})},urlGetParameter:function(a){var d,e,b=decodeURIComponent(window.location.search.substring(1)),c=b.split("&");for(e=0;e<c.length;e++)if(d=c[e].split("="),d[0]===a)return void 0===d[1]||d[1]},updateUrlParameter:function(a,b,c){var d=a.indexOf("#"),e=-1===d?"":a.substr(d);a=-1===d?a:a.substr(0,d);var f=new RegExp("([?&])"+b+"=.*?(&|$)","i"),g=-1!==a.indexOf("?")?"&":"?";return(a=a.match(f)?a.replace(f,"$1"+b+"="+c+"$2"):a+g+b+"="+c)+e},shopLoadmoreBind:function(){HARUSHOP.$shopBrowseWrap.on("click",".haru-loadmore-btn",function(a){a.preventDefault(),HARUSHOP.shopLoadmoreGetPage()})},shopLoadmoreGetPage:function(){if(HARUSHOP.shopAjax)return!1;var b=HARUSHOP.$shopBrowseWrap.find(".haru-loadmore-link").find("a"),c=HARUSHOP.$shopBrowseWrap.find(".haru-loadmore-controls"),d=b.attr("href");d?(d=HARUSHOP.updateUrlParameter(d,"shop_load","products"),c.addClass("haru-loader"),HARUSHOP.shopAjax=a.ajax({url:d,dataType:"html",cache:!1,headers:{"cache-control":"no-cache"},method:"GET",error:function(a,b,c){console.log("Haru: AJAX error - shopLoadmoreGetPage() - "+c)},complete:function(){c.removeClass("haru-loader")},success:function(e){var f=a("<div>"+e+"</div>"),g=f.find("ul.products").children("li.product").css({opacity:0});HARUSHOP.$shopBrowseWrap.find("ul.products").append(g),g.imagesLoaded(function(){g.animate({opacity:1}),a("ul.products").isotope("appended",g),setTimeout(function(){a("ul.products").isotope("layout")},400),HARU.woocommerce.init()}),d=f.find(".haru-loadmore-link").children("a").attr("href"),d?b.attr("href",d):(c.addClass("hide-btn"),a(".haru-loadmore-all").addClass("show"),b.removeAttr("href")),HARUSHOP.shopAjax=!1}})):(c.addClass("hide-btn"),a(".haru-loadmore-all").addClass("show"))}},a(document).ready(HARUSHOP.init)}(jQuery);